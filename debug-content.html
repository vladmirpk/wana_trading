<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Loading Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .debug-section { margin-bottom: 30px; }
        .status-good { color: green; }
        .status-bad { color: red; }
        .status-warning { color: orange; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Content Loading Debug</h1>
        
        <div class="debug-section">
            <h3>1. Embedded Data Check</h3>
            <div id="embeddedCheck"></div>
        </div>
        
        <div class="debug-section">
            <h3>2. Content Loader Test</h3>
            <div id="loaderTest"></div>
        </div>
        
        <div class="debug-section">
            <h3>3. JSON Files Check</h3>
            <div id="jsonCheck"></div>
        </div>
        
        <div class="debug-section">
            <h3>4. Manual Data Injection</h3>
            <button class="btn btn-primary" onclick="injectTestData()">Inject Test Data</button>
            <div id="injectionResult"></div>
        </div>
        
        <div class="debug-section">
            <h3>5. Test Links</h3>
            <a href="one-click-updater.html" class="btn btn-success me-2">Open One-Click Updater</a>
            <a href="admin.html" class="btn btn-info me-2">Open Admin Panel</a>
            <a href="index.html" class="btn btn-warning">Open Main Website</a>
        </div>
    </div>

    <script>
        // Test 1: Check for embedded data
        function checkEmbeddedData() {
            const result = document.getElementById('embeddedCheck');
            
            if (window.embeddedSiteConfig && window.embeddedCarouselSlides && window.embeddedProducts) {
                result.innerHTML = `
                    <div class="status-good">
                        ✅ Embedded data found!<br>
                        Site: ${window.embeddedSiteConfig.company.name}<br>
                        Products: ${window.embeddedProducts.length}<br>
                        Slides: ${window.embeddedCarouselSlides.length}
                    </div>
                `;
            } else {
                result.innerHTML = `
                    <div class="status-warning">
                        ⚠️ No embedded data found. This is normal if you haven't opened admin tools yet.
                    </div>
                `;
            }
        }

        // Test 2: Test content loader
        function testContentLoader() {
            const result = document.getElementById('loaderTest');
            
            // Try to load the content loader
            const script = document.createElement('script');
            script.src = 'js/content-loader.js';
            script.onload = function() {
                setTimeout(() => {
                    if (window.contentLoader) {
                        result.innerHTML = `
                            <div class="status-good">
                                ✅ Content loader loaded successfully!<br>
                                Use Embedded Data: ${window.contentLoader.useEmbeddedData || 'Not set'}
                            </div>
                        `;
                    } else {
                        result.innerHTML = `
                            <div class="status-bad">
                                ❌ Content loader not available
                            </div>
                        `;
                    }
                }, 1000);
            };
            script.onerror = function() {
                result.innerHTML = `
                    <div class="status-bad">
                        ❌ Failed to load content-loader.js
                    </div>
                `;
            };
            document.head.appendChild(script);
        }

        // Test 3: Check JSON files
        async function checkJSONFiles() {
            const result = document.getElementById('jsonCheck');
            
            try {
                const [config, carousel, products] = await Promise.all([
                    fetch('data/site-config.json').then(r => r.json()),
                    fetch('data/carousel-slides.json').then(r => r.json()),
                    fetch('data/products.json').then(r => r.json())
                ]);
                
                result.innerHTML = `
                    <div class="status-good">
                        ✅ JSON files loaded successfully!<br>
                        Site: ${config.company.name}<br>
                        Products: ${products.products.length}<br>
                        Slides: ${carousel.slides.length}
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="status-bad">
                        ❌ Failed to load JSON files: ${error.message}<br>
                        This is expected if you're not running a server.
                    </div>
                `;
            }
        }

        // Test 4: Inject test data
        function injectTestData() {
            const result = document.getElementById('injectionResult');
            
            // Create test data
            window.embeddedSiteConfig = {
                company: {
                    name: "Wana Trading (TEST)",
                    tagline: "Test data injected for debugging",
                    logo: "images/wana_trader.png",
                    logoAlt: "Wana Trading"
                },
                contact: {
                    phones: ["+263 782 712 390"],
                    email: "test@wanatrading.com",
                    address: "Test Address"
                },
                navigation: [
                    { text: "Home", link: "#heroCarousel" },
                    { text: "Products", link: "products.html" }
                ],
                footer: {
                    quickLinks: [{ text: "Home", link: "#heroCarousel" }],
                    services: [{ text: "Test Service", link: "#" }],
                    newsletter: { title: "Newsletter", description: "Test", placeholder: "Email" }
                },
                copyright: {
                    text: "© 2024 Wana Trading (TEST)",
                    designer: "Test Designer"
                }
            };
            
            window.embeddedCarouselSlides = [
                {
                    id: 1,
                    title: "TEST SLIDE",
                    description: "This is a test slide injected for debugging",
                    buttonText: "Test Button",
                    buttonLink: "products.html",
                    image: "images/wana_trader.png",
                    imageAlt: "Test Slide",
                    backgroundColor: "#ff0000",
                    layout: "left"
                }
            ];
            
            window.embeddedProducts = [
                {
                    id: 1,
                    title: "TEST PRODUCT",
                    description: "This is a test product injected for debugging",
                    image: "images/wana_trader.png",
                    imageAlt: "Test Product",
                    category: "Test",
                    badgeColor: "primary",
                    badgeGradient: "linear-gradient(135deg, #667eea, #764ba2)"
                }
            ];
            
            result.innerHTML = `
                <div class="status-good">
                    ✅ Test data injected!<br>
                    Now try opening the main website to see if it picks up this test data.
                </div>
            `;
            
            // Re-check embedded data
            checkEmbeddedData();
        }

        // Run tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkEmbeddedData();
            testContentLoader();
            checkJSONFiles();
        });
    </script>
</body>
</html> 